---
title: "Análise de proximidade de parlamentares com Agronegócio e Meio Ambiente"
output: 
  html_document:
    css: styles.css
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
  fig.cap = '',
  fig.align = 'center',
  fig.width = 10,
  fig.height = 6
)
```

```{r}
library(tidyverse)
library(here)
library(ggchicklet)
library(hrbrthemes)

options(scipen = 999)

theme_set(theme_minimal())

source(here("parlametria/processor/processor_grupos_parlametria.R"))
source(here("parlametria/processor/empresas/processor_indice_atividades_economicas.R"))
source(here("reports/proximidade-agronegocio-meio-ambiente/utils.R"))
```

<br>

## *Resumo*

Este relatório tem o objetivo de criar as visualizações necessárias para construir a narrativa de análise da proximidade de parlamentares com o Agronegócio e com a temática do Meio Ambiente.

## Parlamentares e suas propriedades rurais

Com base no patrimônio declarado na campanha de 2018 ao TSE, filtramos as propriedades rurais dos deputados e senadores que participaram em 2018 e que estão em exercício. Portanto, foram considerados 513 deputados federais e 54 senadores.

```{r}
parlamentares_propriedades <- read_csv(here("parlametria/raw_data/patrimonio/propriedades_rurais.csv"),
                                      col_types = cols(id_parlamentar = "c")) %>% 
  mutate(nome = paste0(str_to_title(nome_eleitoral), " - ", sg_partido, "/", uf))

pallete_1 <- c("#0072B2", "#E69F00", "#999999", "#009E73",
          "#D55E00", "#56B4E9", "#F0E442", "#CC79A7")

parlamentares_exercicio <- read_csv(here("crawler/raw_data/parlamentares.csv"),
                                    col_types = cols(id = "c")) %>% 
  filter(em_exercicio == 1) %>% 
  rename(id_parlamentar = id)
```

Encontramos **`r parlamentares_propriedades %>% pull(n_propriedades) %>% sum()` propriedades rurais** distribuídas entre **`r parlamentares_propriedades %>% filter(casa == "camara") %>% nrow()` deputados** e **`r parlamentares_propriedades %>% filter(casa == "senado") %>% nrow()` senadores**.

```{r fig.height=4}
total_parlamentares <- parlamentares_propriedades %>% 
  count(casa) %>% 
  arrange(casa) %>% ## ordena pelo nome (camara, senado)
  pull(n)

parlamentares_propriedades %>% 
  count(casa) %>% 
  mutate(total_casa_eleitos = if_else(casa == "camara", 513, 54),
         proporcao_parlamentar = if_else(casa == "camara", n / total_casa_eleitos, n / total_casa_eleitos),
         proporcao_geral = 1 - proporcao_parlamentar) %>% 
  gather(key = "key", value = "value", proporcao_parlamentar:proporcao_geral) %>% 
  ggplot(aes(x = casa, y = value, fill = key)) +
  geom_chicklet(width = .3, position = "stack", radius = grid::unit(4, "pt")) +
  scale_y_continuous(breaks = seq(0, 1, 0.2), limits = c(0, 1), labels = scales::percent_format(accuracy = 1)) +
  scale_x_discrete(labels = c("Câmara", "Senado")) +
  scale_fill_manual(values = c("#999999", "#E69F00"), labels = c("Sem propriedades", "Têm propriedades")) +
  coord_flip() +
  
  annotate("text", label = paste0(total_parlamentares[2], " senadores"), x = 2.25, y = 0.08, color = "#4b4545") +
  annotate("text", label = paste0(total_parlamentares[1], " deputados"), x = 1.25, y = 0.08, color = "#4b4545") +
  
  annotate("text", label = "Quase 30% dos senadores eleitos têm propriedades rurais", x = 2.3, y = 0.61, color = "#4b4545") +
  geom_curve(aes(x = 2.2, y = 0.3, xend = 2.3, yend = 0.35),
             color = "#7d7373", size = 0.4, curvature = -0.35,
             arrow = arrow(length = unit(0.3, "cm"), ends="first")) +
  
  labs(y = "Quantos % do total de parlamentares eleitos para a casa",
       x = "",
       title = "Parlamentares com propriedades rurais",
       fill = "") +
  theme_ipsum_rc() +
  theme(legend.position="top")
```

```{r}
levels <- parlamentares_propriedades %>% 
  filter(casa == "camara") %>% 
  arrange(desc(total_declarado)) %>% 
  pull(nome)

total_somado <- parlamentares_propriedades %>% 
  filter(casa == "camara") %>% 
  pull(total_declarado) %>% 
  sum()

parlamentares_propriedades %>% 
  filter(casa == "camara") %>% 
  arrange(desc(total_declarado)) %>% 
  head(15) %>% 
  ggplot(aes(x = fct_rev(factor(nome, levels = levels)), y = total_declarado / 1e6 )) +
  geom_chicklet(fill = "#E69F00") +
  geom_text(aes(label = paste0(round(total_declarado / 1e6, 2))),
            hjust = -0.1,
            size = 3.3,
            color = "#333333") +
  coord_flip() +
  scale_y_continuous(breaks = seq(0, 12, 1), limits = c(0, 12)) +
  
  statebins:::geom_rrect(mapping = aes(xmin = 4.8, xmax = 7.5, ymin = 5.2, ymax = 10.7),
                         radius = grid::unit(10, "pt"),
                         fill = "#EEF0E2",
                         color = "#7C7272") +
  annotate("text",
           label = paste0("O valor somado das propriedades rurais \ndos deputados é de ",
                   round(total_somado / 1e6, 1),
                   " milhões."
                   ),
           x = 6.25, y = 8, color = "#4b4545") +
  
  labs(x = "",
       y = "Patrimônio em propriedades rurais (milhões de reais)",
       title = "Deputados com maiores patrimônios em \npropriedades rurais",
       subtitle = "Em milhões de reais") +
  theme_ipsum_rc()
```

```{r fig.height=4}
levels <- parlamentares_propriedades %>% 
  filter(casa == "senado") %>% 
  arrange(desc(total_declarado)) %>% 
  pull(nome)

total_somado <- parlamentares_propriedades %>% 
  filter(casa == "senado") %>% 
  pull(total_declarado) %>% 
  sum()

parlamentares_propriedades %>% 
  filter(casa == "senado") %>% 
  arrange(desc(total_declarado)) %>% 
  head(5) %>% 
  ggplot(aes(x = fct_rev(factor(nome, levels = levels)), y = total_declarado / 1e6 )) +
  geom_chicklet(fill = "#E69F00", width = .8) +
  geom_text(aes(label = paste0(round(total_declarado / 1e6, 2))),
            hjust = -0.1,
            size = 3.3,
            color = "#333333") +
  coord_flip() +
  scale_y_continuous(breaks = seq(0, 26, 2), limits = c(0, 26)) +
  
  statebins:::geom_rrect(mapping = aes(xmin = 1.2, xmax = 2.8, ymin = 11.3, ymax = 24.3),
                         radius = grid::unit(10, "pt"),
                         fill = "#EEF0E2",
                         color = "#7C7272") +
  annotate("text",
           label = paste0("O valor somado das propriedades rurais \ndos senadores é de ",
                   round(total_somado / 1e6, 1),
                   " milhões."
                   ),
           x = 2, y = 18, color = "#4b4545") +
  
  labs(x = "",
       y = "Patrimônio em propriedades rurais (milhões de reais)",
       title = "Senadores com maiores patrimônios em \npropriedades rurais",
       subtitle = "Em milhões de reais") +
  theme_ipsum_rc()
```

```{r}
todos_parlamentares_propriedades <- parlamentares_exercicio %>% 
  left_join(parlamentares_propriedades %>% 
              select(id_parlamentar, casa, n_propriedades, total_declarado, nome),
            by = c("id_parlamentar", "casa")
            ) %>% 
  select(id_parlamentar, casa, nome, uf, sg_partido, n_propriedades, total_declarado) %>% 
  mutate_at(.vars = vars(n_propriedades, total_declarado), 
            .funs = list(~replace_na(., 0)))
```

```{r fig.height=6.5}
parlamentares_propriedades_camara <- todos_parlamentares_propriedades %>%
  filter(!is.na(sg_partido), 
         casa == 'camara') 
  
levels <- parlamentares_propriedades_camara %>%
  group_by(sg_partido) %>%
  summarise(mean = mean(n_propriedades)) %>%
  arrange(desc(mean)) %>%
  pull(sg_partido)
  
cores_grafico = c("#56B4E9", "#CC79A7")
  
parlamentares_propriedades_camara %>%
  group_by(sg_partido) %>% 
  mutate(n_propriedades_partido = sum(n_propriedades)) %>% 
  ungroup() %>% 
  filter(n_propriedades_partido > 0) %>% 
  group_by(sg_partido) %>% 
  mutate(mean = mean(n_propriedades)) %>% 
  ungroup() %>% 
  ggplot(aes(x = n_propriedades, y = forcats::fct_rev(factor(sg_partido, levels = levels)),
             color = forcats::fct_rev(factor(sg_partido, levels = levels)))) +
  geom_count() +
  geom_point(aes(x = mean), size = 3.5, color = "black", shape = 124) +
  scale_shape_identity() +
  scale_color_manual(values = rep(cores_grafico, 15)) +
  scale_fill_manual(values = rep(cores_grafico, 15)) +
  scale_x_continuous(breaks = seq(0, 15, 2), limits = c(0, 12)) +
  
  geom_point(aes(x = 7.5, y = 15.4), size = 6, color = "black", shape = 124) +
  annotate("text", label = "é a média do partido", x = 8.8, y = 15.4, color = "#4b4545") +
  
  guides(size = F, color = F, fill = F) +
  labs(title = "Distribuição de deputados e suas propriedades rurais \npor partido",
       y = "",
       x = "Número de propriedades rurais dos deputados") +
  theme_ipsum_rc()
```

```{r fig.height=5.5}
parlamentares_propriedades_senado <- todos_parlamentares_propriedades %>%
  filter(!is.na(sg_partido), 
         casa == 'senado') 
  
levels <- parlamentares_propriedades_senado %>%
  group_by(sg_partido) %>%
  summarise(mean = mean(n_propriedades)) %>%
  arrange(desc(mean)) %>%
  pull(sg_partido)
  
cores_grafico = c("#56B4E9", "#CC79A7")
  
parlamentares_propriedades_senado %>%
  group_by(sg_partido) %>% 
  mutate(n_propriedades_partido = sum(n_propriedades)) %>% 
  ungroup() %>% 
  filter(n_propriedades_partido > 0) %>% 
  group_by(sg_partido) %>% 
  mutate(mean = mean(n_propriedades)) %>% 
  ungroup() %>% 
  ggplot(aes(x = n_propriedades, y = forcats::fct_rev(factor(sg_partido, levels = levels)),
             color = forcats::fct_rev(factor(sg_partido, levels = levels)))) +
  geom_count() +
  geom_point(aes(x = mean), size = 3.5, color = "black", shape = 124) +
  scale_shape_identity() +
  scale_color_manual(values = rep(cores_grafico, 15)) +
  scale_fill_manual(values = rep(cores_grafico, 15)) +
  scale_x_continuous(breaks = seq(0, 75, 10), limits = c(0, 75)) +
  
  geom_text(aes(label = ifelse(n_propriedades > 20, 
                             nome, 
                             "")),
            vjust = 2,
            size = 3.5,
            color = "#4b4545") +
    
  geom_point(aes(x = 22.5, y = 9.4), size = 6, color = "black", shape = 124) +
  annotate("text", label = "é a média do partido", x = 30, y = 9.4, color = "#4b4545") +
  
  guides(size = F, color = F, fill = F) +
  labs(title = "Distribuição de senadores e suas propriedades rurais \npor partido",
       y = "",
       x = "Número de propriedades rurais dos senadores") +
  theme_ipsum_rc()
```

## Sócios de empresas agrícolas que doaram para campanha de parlamentares

Em seguida vamos analisar as **doações de sócios de empresas agrícolas** para parlamentares durante a campanha em 2018.

Uma empresa é considerada **agrícola** quando possui pelo menos um CNAE registrado na Receita Federal pertencente a Seção **AGRICULTURA, PECUÁRIA, PRODUÇÃO FLORESTAL, PESCA E AQÜICULTURA**.

```{r}
doacoes_agronegocio <- processa_proporcao_doadores_atividades_economicas(
  doadores_empresas_datapath = here("parlametria/raw_data/empresas/empresas_doadores_agricolas_todos_parlamentares.csv"),
  info_empresas_datapath = here("parlametria/raw_data/empresas/info_empresas_doadores_todos_parlamentares.csv"),
  apenas_cnae_fiscal = FALSE
) %>% 
  filter(grupo_atividade_economica == "AGRICULTURA, PECUÁRIA, PRODUÇÃO FLORESTAL, PESCA E AQÜICULTURA")

parlamentares <- read_csv(here("crawler/raw_data/parlamentares.csv"),
                         col_types = cols(id = "c")) %>% 
  rename(id_parlamentar = id)
parlamentares_doadores_agro <- doacoes_agronegocio %>% 
  left_join(parlamentares %>% 
              select(id_parlamentar, casa, nome_eleitoral, uf, sg_partido), 
            by = c("id_parlamentar", "casa")) %>% 
  mutate(nome = paste0(str_to_title(nome_eleitoral), " - ", sg_partido, "/", uf)) %>% 
  select(id_parlamentar, casa, nome, nome_eleitoral, uf, sg_partido, grupo_atividade_economica, total_por_atividade,
         total_recebido_geral, proporcao_doacao)
```

```{r fig.height=3.5}
total_parlamentares <- parlamentares_doadores_agro %>% 
  group_by(casa) %>% 
  summarise(n_parlamentares = n_distinct(id_parlamentar, casa)) %>% 
  arrange(casa) %>% ## ordena pelo nome (camara, senado)
  pull(n_parlamentares)

parlamentares_doadores_agro %>% 
  group_by(casa) %>% 
  summarise(n_parlamentares = n_distinct(id_parlamentar, casa),
            total_doado = sum(total_por_atividade)) %>% 
  ggplot(aes(x = casa, total_doado / 1e6)) +
  geom_chicklet(width = .4, radius = grid::unit(4, "pt"),
                fill = "#009E73") +
  coord_flip() +
  scale_y_continuous(breaks = seq(0, 14, 1), limits = c(0, 14)) +
  
  annotate("text", label = paste0(total_parlamentares[2], " senadores"), x = 2.3, y = 1, color = "#4b4545") +
  annotate("text", label = paste0(total_parlamentares[1], " deputados"), x = 1.3, y = 1, color = "#4b4545") +
  
  labs(x = "",
       y = "Total doado (milhões de reais)",
       title = "Total doado por sócios de empresas agrícolas",
       subtitle = "Em milhões de reais") +
  theme_ipsum_rc()
```

```{r fig.height=4}
total_parlamentares <- parlamentares_doadores_agro %>% 
  count(casa) %>% 
  arrange(casa) %>% ## ordena pelo nome (camara, senado)
  pull(n)

parlamentares_doadores_agro %>% 
  count(casa) %>% 
  mutate(total_casa_eleitos = if_else(casa == "camara", 513, 54),
         proporcao_parlamentar = if_else(casa == "camara", n / total_casa_eleitos, n / total_casa_eleitos),
         proporcao_geral = 1 - proporcao_parlamentar) %>% 
  gather(key = "key", value = "value", proporcao_parlamentar:proporcao_geral) %>% 
  ggplot(aes(x = casa, y = value, fill = key)) +
  geom_chicklet(width = .3, position = "stack", radius = grid::unit(4, "pt")) +
  scale_y_continuous(breaks = seq(0, 1, 0.1), limits = c(0, 1), labels = scales::percent_format(accuracy = 1)) +
  scale_x_discrete(labels = c("Câmara", "Senado")) +
  scale_fill_manual(values = c("#999999", "#009E73"), labels = c("Não recebeu doações", "Recebeu doações do setor")) +
  coord_flip() +
  
  annotate("text", label = paste0(total_parlamentares[2], " senadores"), x = 2.25, y = 0.08, color = "#4b4545") +
  annotate("text", label = paste0(total_parlamentares[1], " deputados"), x = 1.25, y = 0.08, color = "#4b4545") +
  
  labs(y = "Quantos % do total de parlamentares eleitos para a casa",
       x = "",
       title = "Parlamentares que receberam doações de sócios do setor agrícola",
       fill = "") +
  theme_ipsum_rc() +
  theme(legend.position="top")
```

```{r}
parlamentares_doadores_agro %>% 
  filter(casa == "camara") %>% 
  arrange(desc(total_por_atividade)) %>%
  head(10) %>% 
  ggplot(aes(x = reorder(nome, total_por_atividade), y = total_por_atividade / 1e3)) +
  geom_chicklet(fill = "#009E73") +
  geom_text(aes(label = paste0(format_currency(total_por_atividade))),
            hjust = -0.1,
            size = 3.3,
            color = "#333333") +
  coord_flip() +
  scale_y_continuous(breaks = seq(0, 1e3, 1e2), limits = c(0, 1e3)) +
  labs(x = "",
       y = "Total recebido de sócios de empresas agrícolas (mil reais)",
       title = "Deputados que mais receberam de \nsócios de empresas agrícolas",
       subtitle = "Escala em mil reais") +
  theme_ipsum_rc()
```

```{r}
parlamentares_doadores_agro %>% 
  filter(casa == "senado") %>% 
  arrange(desc(total_por_atividade)) %>%
  head(10) %>% 
  ggplot(aes(x = reorder(nome, total_por_atividade), y = total_por_atividade / 1e6)) +
  geom_chicklet(fill = "#009E73") +
  geom_text(aes(label = paste0(format_currency(total_por_atividade))),
            hjust = -0.1,
            size = 3.3,
            color = "#333333") +
  coord_flip() +
  scale_y_continuous(limits = c(0, 2.2)) +
  labs(x = "",
       y = "Total recebido de sócios de empresas agrícolas (milhões de reais)",
       title = "Senadores que mais receberam de \nsócios de empresas agrícolas",
       subtitle = "Escala em milhões de reais") +
  theme_ipsum_rc()
```

```{r}
todos_parlamentares_doadores_agro <- parlamentares_exercicio %>% 
  left_join(parlamentares_doadores_agro %>% 
              select(id_parlamentar, casa, nome, total_por_atividade, total_recebido_geral, 
                     proporcao_doacao),
            by = c("id_parlamentar", "casa")) %>% 
  select(id_parlamentar, casa, nome, uf, sg_partido, total_por_atividade, total_recebido_geral,
         proporcao_doacao) %>% 
  mutate_at(.vars = vars(total_por_atividade, total_recebido_geral, proporcao_doacao), 
            .funs = list(~replace_na(., 0)))
```

```{r fig.height=8}
parlamentares_doadores_agro_camara <- todos_parlamentares_doadores_agro %>%
  filter(!is.na(sg_partido), 
         casa == 'camara') 
  
levels <- parlamentares_doadores_agro_camara %>%
  group_by(sg_partido) %>%
  summarise(mean = mean(proporcao_doacao)) %>%
  arrange(desc(mean)) %>%
  pull(sg_partido)
  
cores_grafico = c("#56B4E9", "#CC79A7")
  
parlamentares_doadores_agro_camara %>%
  group_by(sg_partido) %>% 
  mutate(total_atividade_partido = sum(total_por_atividade)) %>% 
  ungroup() %>% 
  filter(total_atividade_partido > 0) %>% 
  group_by(sg_partido) %>% 
  mutate(mean = mean(proporcao_doacao)) %>% 
  ungroup() %>% 
  ggplot(aes(x = proporcao_doacao, y = forcats::fct_rev(factor(sg_partido, levels = levels)),
             color = forcats::fct_rev(factor(sg_partido, levels = levels)))) +
  geom_count() +
  geom_point(aes(x = mean), size = 3.5, color = "black", shape = 124) +
  scale_shape_identity() +
  scale_color_manual(values = rep(cores_grafico, 15)) +
  scale_fill_manual(values = rep(cores_grafico, 15)) +
  scale_x_continuous(limits = c(0, 1), labels = scales::percent_format(accuracy = 1)) +
  
  geom_point(aes(x = .3, y = 17.4), size = 6, color = "black", shape = 124) +
  annotate("text", label = "é a média do partido", x = .41, y = 17.4, color = "#4b4545") +
  
  guides(size = F, color = F, fill = F) +
  labs(title = "Distribuição de deputados e a proporção de doações \nvindas de sócios de empresas agrícolas por partido",
       y = "",
       x = "Quanto % veio de sócios de empresas agrícolas") +
  theme_ipsum_rc()
```

```{r fig.height=6}
parlamentares_doadores_agro_senado <- todos_parlamentares_doadores_agro %>%
  filter(!is.na(sg_partido), 
         casa == 'senado') 
  
levels <- parlamentares_doadores_agro_senado %>%
  group_by(sg_partido) %>%
  summarise(mean = mean(proporcao_doacao)) %>%
  arrange(desc(mean)) %>%
  pull(sg_partido)
  
cores_grafico = c("#56B4E9", "#CC79A7")
  
parlamentares_doadores_agro_senado %>%
  group_by(sg_partido) %>% 
  mutate(total_atividade_partido = sum(total_por_atividade)) %>% 
  ungroup() %>% 
  filter(total_atividade_partido > 0) %>% 
  group_by(sg_partido) %>% 
  mutate(mean = mean(proporcao_doacao)) %>% 
  ungroup() %>% 
  ggplot(aes(x = proporcao_doacao, y = forcats::fct_rev(factor(sg_partido, levels = levels)),
             color = forcats::fct_rev(factor(sg_partido, levels = levels)))) +
  geom_count() +
  geom_point(aes(x = mean), size = 3.5, color = "black", shape = 124) +
  scale_shape_identity() +
  scale_color_manual(values = rep(cores_grafico, 15)) +
  scale_fill_manual(values = rep(cores_grafico, 15)) +
  scale_x_continuous(limits = c(0, 1), labels = scales::percent_format(accuracy = 1)) +
  
  geom_point(aes(x = .3, y = 11.4), size = 6, color = "black", shape = 124) +
  annotate("text", label = "é a média do partido", x = .4, y = 11.4, color = "#4b4545") +
  
  geom_text(aes(label = ifelse(proporcao_doacao > .25, 
                           nome, 
                           "")),
            vjust = 2,
            size = 3.5,
            color = "#4b4545") +
  
  guides(size = F, color = F, fill = F) +
  labs(title = "Distribuição de senadores e a proporção de doações \nvindas de sócios de empresas agrícolas por partido",
       y = "",
       x = "Quanto % veio de sócios de empresas agrícolas") +
  theme_ipsum_rc()
```

## Parlamentares e suas empresas agrícolas

Filtramos os parlamentares que possuem pelo menos uma empresa considerada agrícola. Foram consideradas as empresas cujo CNAEs fiscal ou secundários se enquadram nos setores econômicos correspondentes à **Agricultura, pecuária, produção florestal, pesca e aqüicultura**.

```{r}
parlamentares_empresas <- read_csv(here("parlametria/raw_data/empresas/socios_empresas_agricolas_todos_parlamentares.csv"))

parlamentares <- read_csv(here("crawler/raw_data/parlamentares.csv"))

parlamentares_socios_empresas <- parlamentares_empresas %>% 
  select(-c(nome_socio, cnpj_cpf_do_socio)) %>% 
  left_join(parlamentares, by = c("id_parlamentar" = "id", "casa")) %>% 
  filter(em_exercicio == 1)
```

```{r fig.height=4}
total_parlamentares_socios_empresas <- parlamentares_socios_empresas %>% 
  group_by(casa) %>% 
  summarise(n = n_distinct(id_parlamentar)) %>% 
  arrange(casa) %>% ## ordena pelo nome (camara, senado)
  pull(n)

parlamentares_socios_empresas %>% 
  group_by(casa) %>% 
  summarise(n = n_distinct(id_parlamentar)) %>% 
  mutate(total_casa_eleitos = if_else(casa == "camara", 513, 81),
         proporcao_parlamentar = if_else(casa == "camara", n / total_casa_eleitos, n / total_casa_eleitos),
         proporcao_geral = 1 - proporcao_parlamentar) %>% 
  gather(key = "key", value = "value", proporcao_parlamentar:proporcao_geral) %>% 
  ggplot(aes(x = casa, y = value, fill = key)) +
  geom_chicklet(width = .3, position = "stack", radius = grid::unit(4, "pt")) +
  scale_y_continuous(breaks = seq(0, 1, 0.2), limits = c(0, 1), labels = scales::percent_format(accuracy = 1)) +
  scale_x_discrete(labels = c("Câmara", "Senado")) +
  scale_fill_manual(values = c("#999999", "#56B4E9"), labels = c("Sem empresas", "Sócios de empresas")) +
  coord_flip() +
  
  annotate("text", label = paste0(total_parlamentares_socios_empresas[2], " senadores"), x = 2.25, y = 0.08, color = "#4b4545") +
  annotate("text", label = paste0(total_parlamentares_socios_empresas[1], " deputados"), x = 1.25, y = 0.08, color = "#4b4545") +
  
  labs(y = "% do total de parlamentares",
       x = "",
       title = "Parlamentares que são sócios de empresas agrícolas",
       fill = "") +
  theme_ipsum_rc() +
  theme(legend.position="top")
```

```{r}
parlamentares_socios_empresas_partido_camara <-
  parlamentares_socios_empresas %>%
  filter(!is.na(sg_partido), casa == 'camara') 
  
levels <- parlamentares_socios_empresas_partido_camara %>%
  group_by(id_parlamentar, sg_partido) %>%
  summarise(num_empresas = n_distinct(cnpj)) %>%
  ungroup() %>% 
  group_by(sg_partido) %>%
  summarise(mean = mean(num_empresas)) %>%
  arrange(desc(mean)) %>%
  pull(sg_partido)
  
cores_grafico = c("#56B4E9", "#CC79A7")
  
parlamentares_socios_empresas_partido_camara %>%
  group_by(id_parlamentar, sg_partido) %>%
  summarise(num_empresas_total = n_distinct(cnpj)) %>%
  ungroup() %>%
  group_by(sg_partido) %>% 
  mutate(mean = mean(num_empresas_total)) %>% 
  ungroup() %>% 
  ggplot(
  aes(
  x = num_empresas_total,
  y = forcats::fct_rev(factor(sg_partido, levels = levels)),
  color = forcats::fct_rev(factor(sg_partido, levels = levels))
  )
  ) +
  geom_count() +
  geom_point(aes(x = mean), size = 3.5, color = "black", shape = 124) +
  scale_shape_identity() +
  scale_color_manual(values = rep(cores_grafico, 15)) +
  scale_fill_manual(values = rep(cores_grafico, 15)) +
  scale_x_continuous(limits = c(0, 50)) +
  annotate("text", label = "Deputado \nNewton Cardoso Júnior", x = 42.5, y = 12, color = "#4b4545") +
  geom_curve(aes(x = 47.5, y = 14, xend = 42, yend = 12.8),
             color = "#7d7373", size = 0.35, curvature = 0.35,
             arrow = arrow(length = unit(0.3, "cm"), ends="first")) +
  guides(size = F, color = F, fill = F) +
  labs(title = "Distribuição de deputados\nsócios de empresas agrícolas por partido",
  y = "Partido",
  x = "Número de empresas dos deputados") +
  theme_ipsum_rc() +
  theme(
  axis.text.y = element_text(size = 12),
  axis.title.x = element_text(size = 11),
  axis.title.y = element_text(size = 11)
  )
```


```{r fig.height=4}
parlamentares_socios_empresas_partido_senado <-
  parlamentares_socios_empresas %>%
  filter(!is.na(sg_partido), casa == 'senado') 
  
levels <- parlamentares_socios_empresas_partido_senado %>%
  group_by(id_parlamentar, sg_partido) %>%
  summarise(num_empresas = n_distinct(cnpj)) %>%
  ungroup() %>% 
  group_by(sg_partido) %>%
  summarise(mean = mean(num_empresas)) %>%
  arrange(desc(mean)) %>%
  pull(sg_partido)
  
cores_grafico = c("#56B4E9", "#CC79A7")
  
parlamentares_socios_empresas_partido_senado %>%
  group_by(id_parlamentar, sg_partido) %>%
  summarise(num_empresas_total = n_distinct(cnpj)) %>%
  ungroup() %>%
  group_by(sg_partido) %>% 
  mutate(mean = mean(num_empresas_total)) %>% 
  ungroup() %>% 
  ggplot(
  aes(
  x = num_empresas_total,
  y = forcats::fct_rev(factor(sg_partido, levels = levels)),
  color = forcats::fct_rev(factor(sg_partido, levels = levels))
  )
  ) +
  geom_count() +
  geom_point(aes(x = mean), size = 3.5, color = "black", shape = 124) +
  scale_shape_identity() +
  scale_color_manual(values = rep(cores_grafico, 15)) +
  scale_fill_manual(values = rep(cores_grafico, 15)) +
  scale_x_continuous(limits = c(0, 6), breaks = seq(0, 10, 2)) +
  annotate("text", label = "Senador \nJayme Veríssimo de Campos", x = 4.7, y = 4, color = "#4b4545") +
  geom_curve(aes(x = 4.95, y = 5, xend = 4.7, yend = 4.5),
             color = "#7d7373", size = 0.35, curvature = 0.1,
             arrow = arrow(length = unit(0.3, "cm"), ends="first")) +
  guides(size = F, color = F, fill = F) +
  labs(title = "Distribuição de senadores\nsócios de empresas agrícolas por partido",
  y = "Partido",
  x = "Número de empresas dos senadores") +
  theme_ipsum_rc() +
  theme(
  axis.text.y = element_text(size = 12),
  axis.title.x = element_text(size = 11),
  axis.title.y = element_text(size = 11)
  )
```

```{r}
parlamentares_socios_empresas_camara <-
  parlamentares_socios_empresas_partido_camara %>%
  mutate(nome_processado = paste0(str_to_title(nome_eleitoral), ' - ', sg_partido, '/', uf))
  
  levels <- parlamentares_socios_empresas_camara %>%
  group_by(id_parlamentar, nome_processado) %>%
  summarise(n = n_distinct(cnpj)) %>%
  arrange(desc(n)) %>%
  head(15) %>%
  pull(nome_processado)
  
  parlamentares_socios_empresas_camara %>%
  group_by(id_parlamentar, nome_processado) %>%
  summarise(n = n_distinct(cnpj)) %>%
  arrange(desc(n)) %>%
  head(15) %>%
  ggplot(aes(x = fct_rev(factor(nome_processado, levels = levels)), y = n)) +
  geom_chicklet(fill = "#56B4E9", width = .8) +
  coord_flip() +
  scale_y_continuous(limits = c(0, 50), breaks = seq(0, 50, 10)) +
  geom_text(aes(label = n),
            hjust = -0.1,
            size = 3.3,
            color = "#333333") +
  coord_flip() +
  labs(x = "",
       y = "Número de empresas agrícolas",
       title = "Deputados sócios de empresas agrícolas") +
  theme_ipsum_rc()
```

```{r fig.height=3}
parlamentares_socios_empresas_senado <-
  parlamentares_socios_empresas_partido_senado %>%
  mutate(nome_processado = paste0(str_to_title(nome_eleitoral), ' - ', sg_partido, '/', uf))
  
  levels <- parlamentares_socios_empresas_senado %>%
  group_by(id_parlamentar, nome_processado) %>%
  summarise(n = n_distinct(cnpj)) %>%
  arrange(desc(n)) %>%
  head(5) %>%
  pull(nome_processado)
  
  parlamentares_socios_empresas_senado %>%
  group_by(id_parlamentar, nome_processado) %>%
  summarise(n = n_distinct(cnpj)) %>%
  arrange(desc(n)) %>%
  head(5) %>%
  ggplot(aes(x = fct_rev(factor(nome_processado, levels = levels)), y = n)) +
  geom_chicklet(fill = "#56B4E9", width = .8) +
  coord_flip() +
  scale_y_continuous(limits = c(0, 5), breaks = seq(0, 5, 1)) +
  # geom_text(aes(label = n),
  #           hjust = -0.1,
  #           size = 3.3,
  #           color = "#333333") +
  coord_flip() +
  labs(x = "",
       y = "Número de empresas agrícolas",
       title = "Senadores sócios de empresas agrícolas") +
  theme_ipsum_rc()
```
 


## Como os índices foram criados?

A análise apresentada neste documento é baseada em três índices que condensam dados de diferentes perspectivas sobre os parlamentares atualmente em exercício.

- **Índice de vínculo econômico com o agronegócio:** considera a declaração ao TSE da posse de propriedades rurais (além de terras, gado, tratores etc), as empresas agrícolas das quais são sócios, segundo a Receita Federal, e as doações de campanhas recebidas de pessoas físicas que eram sócias de empresas agrícolas (incluindo exportadoras).

- **Índice de ativismo ambiental:** considera a associação a frentes parlamentares progressistas (ambiental, indígenas, ODS, OSC e prestação de serviços ambientais) e a frentes mais conservadoras (agropecuária, mineração e livre mercado), as proposições apresentadas com conteúdo de meio ambiente, os requerimentos de informações apresentados aos ministérios de Meio-ambiente e Agricultura, a aderência à orientação do governo em votações nominais sobre meio-ambiente e a pontuação qualitativa do discurso sobre Meio-ambiente levantado pela [Pulso Público](https://www.pulsopublico.com.br/).

- **Índice de importância política:** considera o número de mandatos prévios, as posições de liderança na Câmara (Mesa Diretora, presidência ou vice-presidência de partido/bloco e comissões) e o número de comissões das quais é titular.

```{r}
parlamentares_indices <- read_csv(here("parlametria/raw_data/grupos_parlametria/grupos_parlamentares_parlametria.csv"),
                                  col_types = cols(id = "c"))

deputados_indices <- parlamentares_indices %>% 
  filter(casa == "camara")

senadores_indices <- parlamentares_indices %>% 
  filter(casa == "senado")
```

<br> 

### Como os grupos foram formados?
Os grupos foram formados usando critérios a partir dos índices e do partidos dos parlamentares.

<br>

### Vínculo com o agronegócio

#### **Deputados financiados pelo agronegócio e simpáticos ao Meio Ambiente**

Deputados que, mesmo com vínculo econômico com o agronegócio, possuem uma atividade parlamentar significativa em matéria ambiental. Para esse grupo, recomenda-se uma estratégia de comunicação que destaque a importância da preservação ambiental como um ativo que valoriza as exportações brasileiras do agronegócio - assim como destaque os riscos de prejuízos econômicos que a aprovação de leis e políticas públicas desfavoráveis ao meio ambiente pode trazer para o setor.

```{r}
plot_dispersao_grupos <- function(subgrupo_filtrado, titulo) {
  
  pallete_2 <- c("#999999", "#00AFBB")

  deputados_indices %>% 
    mutate(selecionado = ifelse(subgrupo == subgrupo_filtrado,
                                TRUE,
                                FALSE)) %>% 
    mutate(selecionado = replace_na(selecionado, FALSE)) %>% 
    ggplot(aes(x = indice_vinculo_economico_agro, y = indice_ativismo_ambiental, color = selecionado)) +
    geom_jitter(width = 0.01) +
    scale_color_manual(values = pallete_2, labels = c("Outros", "Pertence ao grupo")) +
    labs(x = "Índice de Vínculo Econômico com o Agronegócio",
         y = "Índice de Ativismo Ambiental",
         title = titulo,
         color = "") +
    theme_ipsum_rc() +
    theme(
      legend.position = c(.95, .95),
      legend.justification = c("right", "top"),
      legend.box.just = "right",
      legend.margin = margin(6, 6, 6, 6)
      )
}
```

```{r}
plot_dispersao_grupos("Financiados pelo Agro e simpáticos ao Meio Ambiente", "Deputados ligados ao Agro e simpáticos ao Meio Ambiente")
```


#### **Deputados financiados pelo agronegócio e ligados à exportação**

Parlamentares que, mesmo sem um “ativismo ambiental” relevante, tiveram boa parte de suas campanhas financiadas pelo agronegócio exportador.
Este grupo, que tem tido uma atuação avessa à causa ambiental nesta legislatura, pode tentar ser convencido a mudar seu posicionamento por meio da sua dependência financeira em relação a doadores de campanha que são agroexportadores. Eventualmente pode-se buscar uma estratégia de mediação por meio desses empresários que financiaram mais do que 10% dos gastos de campanha desse grupo de parlamentares.

```{r}
plot_dispersao_grupos("Financiado pelo agro e ligado a exportação", 
                      "Deputados ligados ao Agro e a exportação")
```

<br>

### Oposição

#### **Membros da oposição ligados ao Meio Ambiente**

Deputados que, independentemente do vínculo econômico com o agronegócio, têm atividade parlamentar significativa em matéria ambiental.
Trata-se do grupo mais favorável à causa socioambiental, que é reforçada pela atuação na centro-esquerda e na oposição ao governo. 

```{r}
plot_dispersao_grupos("Oposição e alto ativismo ambiental", 
                      "Deputados da oposição com alto ativismo ambiental")
```


### Zona Cinza

#### **Deputados com baixo vínculo com o agronegócio, porém simpáticos ao Meio Ambiente**

Deputados sem vínculo econômico com o agronegócio, mas com atividade parlamentar relevante em matéria ambiental.

Aqui também temos um grupo importante de parlamentares que merecem ser trabalhados de modo especial. Apesar de não terem vínculos econômicos com o agronegócio e atuarem em partidos de centro e direita, esses deputados estão tendo uma atuação positiva na área socioambiental nesta legislatura, e merecem, portanto, ter o seu trabalho reconhecido e destacado pelas entidades do setor. Estreitar os laços com esse grupo pode ser extremamente estratégico para diminuir resistência ao trabalho das organizações sociais da área, ainda mais porque, em tempos de polarização exacerbada, esses deputados não pertencem a partidos de oposição ao governo. Ampliar o diálogo com esses deputados pode ser muito proveitoso em termos de construir pontes com parlamentares do centro e da direita.

```{r}
plot_dispersao_grupos("Sem vínculo econômico, mas ativistas ambientais", 
                      "Deputados sem proximidade econômica mas com ligação ao Meio Ambiente")
```



