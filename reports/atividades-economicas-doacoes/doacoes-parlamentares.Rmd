---
title: "Financiamento de grandes grupos econômicos na Campanha de parlamentares em exercício"
output: 
  html_document:
    css: styles.css
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
  fig.cap = '',
  fig.align = 'center',
  fig.width = 10,
  fig.height = 8
)
```

```{r}
library(tidyverse)
library(here)
library(hrbrthemes)
library(plotly)
library(ggchicklet)
library(ggridges)

theme_set(theme_minimal())
options(scipen = 999)
```

```{r}
doacoes_sumario <- read_csv(here("parlametria/raw_data/empresas/parlamentares_ligacao_atividade_economica.csv"),
                            col_types = cols(id_parlamentar = "c"))
```

Em 2018, quando foram eleitos 513 Deputados Federais e 54 Senadores, a eleição não permitiu a doação direta de empresas (pessoas jurídicas) para os candidatos, apenas doações de pessoas físicas. Iremos explorar nessa análise a participação dessas pessoas físicas como sócias de empresas e quais os grupos de atividades econômicas que essas empresas pertencem.

Quando for falado em doações de grupos econômicos para Parlamentares, deve ser intepretado como doações de sócios de empresas que atuam neste grupo econômico. Grupo econômico é o ramo de atividade que a empresa pode atuar. A classificação é obtida através da declaração dos CNAE's das empresas na Receita Federal. Uma empresa pode atuar em mais de um grupo econômico.

A seguir iremos visualizar quais os grupos econômicos que mais doaram para parlamentares (deputados e senadores) em 2018.

```{r}
doacoes_sumario_por_atividade <- doacoes_sumario %>% 
  group_by(grupo_atividade_economica) %>% 
  summarise(total = sum(total_por_atividade))
```

```{r}
levels <- doacoes_sumario_por_atividade %>%
  arrange(desc(total)) %>% 
  pull(grupo_atividade_economica)

doacoes_sumario_por_atividade %>% 
  arrange(desc(total)) %>% 
  head(15) %>% 
  ggplot(aes(x = fct_rev(factor(grupo_atividade_economica, levels = levels)), y = total / 1e6, fill = "a")) +
  geom_chicklet(width = .7, radius = grid::unit(5, "pt")) +
  geom_text(aes(label = paste0(round(total / 1e6, 2))),
            hjust = -0.1,
            size = 3.3,
            color = "#333333") +
  coord_flip() +
  scale_fill_manual(values = c("#806CCC")) +
  scale_y_continuous(limits = c(0, 80)) +
  guides(fill = FALSE) + 
  labs(title = "Grupos econômicos \nque mais doaram",
       y = "Total doado para parlamentares (milhões de reais)",
       x = "") +
  theme_ipsum_rc() +
  theme(axis.text.y = element_text(size = 10))
```

Atividades imobiliárias, atividades financeiras e o grupo de atividades profissionais foram os grandes doadores em 2018. Como uma doação vem de um sócio e não de uma empresa, e esta mesma empresa pode atuar em diferentes grupos econômicos, uma mesma doação pode contar como doação no montante de mais de um grupo econômico. Ou seja, estamos considerando no montante de todas os grupos econômicos de uma empresa a doação de seu sócio a um parlamentar.

```{r}
parlamentares_investimento <- read_csv(here("parlametria/raw_data/resumo/parlamentares_investimento.csv"),
                                       col_types = cols(id = "c")) %>%
  select(id_parlamentar = id, casa, partido_eleicao)

doacoes_sumario_alt <- doacoes_sumario %>%
  left_join(parlamentares_investimento, by = c("id_parlamentar", "casa"))
```

## Distribuição dos parlamentares por Grupo

```{r}
levels <- doacoes_sumario_alt %>% 
  filter(!is.na(proporcao_doacao)) %>% 
  group_by(grupo_atividade_economica) %>% 
  summarise(median = median(proporcao_doacao)) %>% 
  ungroup() %>% 
  arrange(desc(median)) %>% 
  pull(grupo_atividade_economica)

top_grupos <- levels %>% 
  head(15)
  
doacoes_sumario_alt %>% 
  filter(!is.na(proporcao_doacao)) %>% 
  mutate(proporcao_doacao = proporcao_doacao * 100) %>% 
  group_by(grupo_atividade_economica) %>% 
  mutate(median = median(proporcao_doacao)) %>% 
  ungroup() %>%
  ggplot(aes(x = proporcao_doacao, y = factor(grupo_atividade_economica, levels = levels))) +
  # geom_density_ridges(
  #   aes(height = ..density..),
  #   stat = "density", trim = TRUE,
  #   scale = 0.9
  # ) +
  geom_count(alpha = 0.5) +
  scale_shape_identity() +
  geom_point(aes(x = median), size = 3.5, color = "#dc267f", shape = 124) +
  
  geom_point(aes(x = 13.5, y = 7.5), size = 3.5, color = "#dc267f", shape = 124) +
  annotate("text", label = "é a mediana", x = 15.2, y = 7.5, color = "#4b4545") +
  
  # scale_x_continuous(breaks = seq(0, 100, 2)) +
  guides(size = FALSE) +
  labs(title = "Distribuição do investimento por cargo \nna câmara",
       x = "Proporção de campanhas médias (%)",
       y = "Cargo") + 
  theme_ipsum_rc()
```



